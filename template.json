{
	"Parameters": {
		"DomainName": {
			"Type": "String",
			"Description": "domain name"
    },
    "HostedZoneId": {
			"Type": "String",
			"Description": "id of the hosted zone"
		},
		"AcmCertificateArn": {
			"Type": "String",
			"Description": "the Amazon Resource Name (ARN) of an AWS Certificate Manager (ACM) certificate.",
			"AllowedPattern": "arn:aws:acm:.*"
		}
	},
	"Resources": {
		"Bucket": {
			"Type": "AWS::S3::Bucket",
			"Properties": {
				"BucketName": { "Ref": "DomainName" },
				"WebsiteConfiguration": {
					"IndexDocument": "index.html",
					"ErrorDocument": "index.html"
				}
			}
    },
    "BucketPolicy": {
			"Type": "AWS::S3::BucketPolicy",
			"Properties": {
				"Bucket": { "Ref": "Bucket" },
				"PolicyDocument": {
					"Version":"2012-10-17",
					"Id":"PolicyForCloudFrontPrivateContent",
					"Statement":[
						{
							"Sid": "Grant a CloudFront Origin Identity access to support private content",
							"Effect": "Allow",
							"Principal": { "CanonicalUser": {"Fn::GetAtt": ["OriginAccessIdentity", "S3CanonicalUserId" ] } },
							"Action": "s3:GetObject",
							"Resource": { 
								"Fn::Sub": [
									"arn:aws:s3:::${BucketName}/*", {
										"BucketName": { "Ref": "Bucket" }
									}
								]
							}
						}
					]
				}
			}
		},
		"OriginAccessIdentity": {
			"Type": "AWS::CloudFront::CloudFrontOriginAccessIdentity",
			"Properties": {
				"CloudFrontOriginAccessIdentityConfig": {
					"Comment": { "Ref": "DomainName" }
				}
			}
		},
		"Distribution" : {
			"Type" : "AWS::CloudFront::Distribution",
			"Properties" : {
				"DistributionConfig" : {
						"Origins" : [ {
								"DomainName" : { "Fn::GetAtt": ["Bucket", "DomainName"] },
								"Id" : "S3Origin",
								"S3OriginConfig" : {
										"OriginAccessIdentity" : {
											"Fn::Sub": [
												"origin-access-identity/cloudfront/${OriginAccessIdentity}",
												{ "OriginAccessIdentity": { "Ref": "OriginAccessIdentity" } }
											]
										}
								}
						}],
						"Enabled" : "true",
						"Comment" : { "Ref": "DomainName" },
						"DefaultRootObject" : "index.html",
						"Aliases" : [ { "Ref": "DomainName" } ],
						"DefaultCacheBehavior" : {
								"AllowedMethods" : [ "GET", "HEAD" ],
								"Compress": "true",
								"TargetOriginId" : "S3Origin", 
								"ForwardedValues" : {
										"QueryString" : "true",
										"Cookies" : { "Forward" : "none" }
								},
								"ViewerProtocolPolicy" : "redirect-to-https"
						},
						"PriceClass" : "PriceClass_200",
						"ViewerCertificate" : {
							"AcmCertificateArn": { "Ref": "AcmCertificateArn" },
							"SslSupportMethod": "sni-only"
						}
				}
			}
		},
		"DNSRecord": {
			"Type": "AWS::Route53::RecordSetGroup",
			"Properties": {
				"HostedZoneId": { "Ref": "HostedZoneId" },
				"RecordSets": [{
					"Name": { "Ref": "DomainName" },
					"Type": "A",
					"AliasTarget": {
						"HostedZoneId": "Z2FDTNDATAQYW2",
						"DNSName": { "Fn::GetAtt": ["Distribution", "DomainName"] }
					}
				}]
			}
		}
	},
	"Outputs": {
		"DistrobutionId": {
			"Description": "the CloudFront Distribution ID.",
			"Value": {
				"Ref": "Distribution"
			}
		}
	}
}